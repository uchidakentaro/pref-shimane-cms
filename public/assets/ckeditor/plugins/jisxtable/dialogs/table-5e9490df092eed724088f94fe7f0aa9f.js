!function(){function t(t){for(var e,i=0,n=0,l=0,a=t.$.rows.length;l<a;l++){e=t.$.rows[l],i=0;for(var o,s=0,d=e.cells.length;s<d;s++)o=e.cells[s],i+=o.colSpan;i>n&&(n=i)}return n}function e(t){return function(){var e=this.getValue(),i=!!(CKEDITOR.dialog.validate.integer()(e)&&e>0);return i||(alert(t),this.select()),i}}function i(t){var e=this.att,i=t&&t.hasAttribute(e)&&t.getAttribute(e)||"";i!==undefined&&this.setValue(i)}function n(){for(var t,e=0;e<arguments.length;e++)if(arguments[e]instanceof CKEDITOR.dom.element){t=arguments[e];break}if(t){var i=this.att,n=this.getValue();n?t.setAttribute(i,n):t.removeAttribute(i,n)}}function l(t,e,l){e||(e=d);var a=t.lang.common,o={id:"advanced",label:a.advancedTab,title:a.advancedTab,elements:[{type:"vbox",padding:1,children:[]}]},s=[];return(e.id||e.dir)&&(e.id&&s.push({id:"advId",att:"id",type:"text",requiredContent:l?l+"[id]":null,label:a.id,setup:i,commit:n}),e.dir&&s.push({id:"advLangDir",att:"dir",type:"select",requiredContent:l?l+"[dir]":null,label:a.langDir,"default":"ltr",style:"width:100%",items:[[a.langDirLTR,"ltr"],[a.langDirRTL,"rtl"]],commit:n}),o.elements[0].children.push({type:"hbox",widths:["50%","50%"],children:[].concat(s)})),(e.styles||e.classes)&&(s=[],e.styles&&s.push({id:"advStyles",att:"style",type:"text",requiredContent:l?l+"{cke-xyz}":null,label:a.styles,"default":"",validate:CKEDITOR.dialog.validate.inlineStyle(a.invalidInlineStyle),onChange:function(){},getStyle:function(t,e){var i=this.getValue().match(new RegExp("(?:^|;)\\s*"+t+"\\s*:\\s*([^;]*)","i"));return i?i[1]:e},updateStyle:function(e,i){var n=this.getValue(),l=t.document.createElement("span");l.setAttribute("style",n),l.setStyle(e,i),n=CKEDITOR.tools.normalizeCssText(l.getAttribute("style")),this.setValue(n,1)},setup:i,commit:n}),e.classes&&s.push({type:"hbox",widths:["45%","55%"],children:[{id:"advCSSClasses",att:"class",type:"text",requiredContent:l?l+"(cke-xyz)":null,label:a.cssClasses,"default":"",setup:i,commit:n}]}),o.elements[0].children.push({type:"hbox",widths:["50%","50%"],children:[].concat(s)})),o}function a(i,n){var a=function(t){return new CKEDITOR.dom.element(t,i.document)},d=i.editable();i.plugins.dialogadvtab;return{title:i.lang.jisxtable.title,minWidth:310,minHeight:CKEDITOR.env.ie?310:280,onLoad:function(){var t=this,e=t.getContentElement("advanced","advStyles");e&&e.on("change",function(){var e=this.getStyle("width",""),i=t.getContentElement("info","txtWidth");i&&i.setValue(e,!0);var n=this.getStyle("height",""),l=t.getContentElement("info","txtHeight");l&&l.setValue(n,!0)})},onShow:function(){var t,e=i.getSelection(),l=e.getRanges(),a=this.getContentElement("info","txtRows"),o=this.getContentElement("info","txtCols"),s=this.getContentElement("info","txtWidth"),d=this.getContentElement("info","txtHeight");if("jisxtableProperties"==n){var r=e.getSelectedElement();r&&r.is("table")?t=r:l.length>0&&(CKEDITOR.env.webkit&&l[0].shrink(CKEDITOR.NODE_ELEMENT),t=i.elementPath(l[0].getCommonAncestor(!0)).contains("table",1)),this._.selectedElement=t}t?(this.setupContent(t),a&&a.disable(),o&&o.disable()):(a&&a.enable(),o&&o.enable()),s&&s.onChange(),d&&d.onChange()},onOk:function(){var t=i.getSelection(),e=this._.selectedElement&&t.createBookmarks(),n=this._.selectedElement||a("table"),l={};if(this.commitContent(l,n),l.info){var o=l.info;if(!this._.selectedElement)for(var s=n.append(a("tbody")),d=parseInt(o.txtRows,10)||0,r=parseInt(o.txtCols,10)||0,h=0;h<d;h++)for(var c=s.append(a("tr")),u=0;u<r;u++){var m=c.append(a("td"));CKEDITOR.env.ie||m.append(a("br"))}var g=o.selHeaders;if(!n.$.tHead&&("row"==g||"both"==g)){var b=new CKEDITOR.dom.element(n.$.createTHead());s=n.getElementsByTag("tbody").getItem(0);var p=s.getElementsByTag("tr").getItem(0);for(h=0;h<p.getChildCount();h++){var f=p.getChild(h);f.type!=CKEDITOR.NODE_ELEMENT||f.data("cke-bookmark")||(f.renameNode("th"),f.setAttribute("scope","col"))}b.append(p.remove())}if(null!==n.$.tHead&&"row"!=g&&"both"!=g){b=new CKEDITOR.dom.element(n.$.tHead),s=n.getElementsByTag("tbody").getItem(0);for(var v=s.getFirst();b.getChildCount()>0;){for(p=b.getFirst(),h=0;h<p.getChildCount();h++){var C=p.getChild(h);C.type==CKEDITOR.NODE_ELEMENT&&(C.renameNode("td"),C.removeAttribute("scope"))}p.insertBefore(v)}b.remove()}if(!this.hasColumnHeaders&&("col"==g||"both"==g))for(c=0;c<n.$.rows.length;c++)C=new CKEDITOR.dom.element(n.$.rows[c].cells[0]),C.renameNode("th"),C.setAttribute("scope","row");if(this.hasColumnHeaders&&"col"!=g&&"both"!=g)for(h=0;h<n.$.rows.length;h++)c=new CKEDITOR.dom.element(n.$.rows[h]),"tbody"==c.getParent().getName()&&(C=new CKEDITOR.dom.element(c.$.cells[0]),C.renameNode("td"),C.removeAttribute("scope"));o.txtHeight?n.setStyle("height",o.txtHeight):n.removeStyle("height"),o.txtWidth?n.setStyle("width",o.txtWidth):n.removeStyle("width"),n.getAttribute("style")||n.removeAttribute("style")}if(this._.selectedElement)try{t.selectBookmarks(e)}catch(t){}else i.insertElement(n),setTimeout(function(){var t=new CKEDITOR.dom.element(n.$.rows[0].cells[0]),e=i.createRange();e.moveToPosition(t,CKEDITOR.POSITION_AFTER_START),e.select()},0)},contents:[{id:"info",label:i.lang.jisxtable.title,elements:[{type:"hbox",widths:[null,null],styles:["vertical-align:top"],children:[{type:"vbox",padding:0,children:[{type:"text",id:"txtRows","default":3,label:i.lang.jisxtable.rows,required:!0,controlStyle:"width:5em",validate:e(i.lang.jisxtable.invalidRows),setup:function(t){this.setValue(t.$.rows.length)},commit:s},{type:"text",id:"txtCols","default":2,label:i.lang.jisxtable.columns,required:!0,controlStyle:"width:5em",validate:e(i.lang.jisxtable.invalidCols),setup:function(e){this.setValue(t(e))},commit:s},{type:"html",html:"&nbsp;"},{type:"select",id:"selHeaders",requiredContent:"th","default":"row",label:i.lang.jisxtable.headers,items:[[i.lang.jisxtable.headersRow,"row"],[i.lang.jisxtable.headersColumn,"col"],[i.lang.jisxtable.headersBoth,"both"]],setup:function(t){var e=this.getDialog();e.hasColumnHeaders=!0;for(var i=0;i<t.$.rows.length;i++){var n=t.$.rows[i].cells[0];if(n&&"th"!=n.nodeName.toLowerCase()){e.hasColumnHeaders=!1;break}}null!==t.$.tHead?this.setValue(e.hasColumnHeaders?"both":"row"):this.setValue(e.hasColumnHeaders?"col":"")},commit:s},{type:"text",id:"txtBorder",requiredContent:"table[border]","default":i.filter.check("table[border]")?1:0,label:i.lang.jisxtable.border,controlStyle:"width:3em",validate:CKEDITOR.dialog.validate.number(i.lang.jisxtable.invalidBorder),setup:function(t){this.setValue(t.getAttribute("border")||"")},commit:function(t,e){this.getValue()?e.setAttribute("border",this.getValue()):e.removeAttribute("border")}},{id:"cmbAlign",type:"select",requiredContent:"table[align]","default":"",label:i.lang.common.align,items:[[i.lang.common.notSet,""],[i.lang.common.alignLeft,"left"],[i.lang.common.alignCenter,"center"],[i.lang.common.alignRight,"right"]],setup:function(t){this.setValue(t.getAttribute("align")||"")},commit:function(t,e){this.getValue()?e.setAttribute("align",this.getValue()):e.removeAttribute("align")}}]},{type:"vbox",padding:0,children:[{type:"hbox",widths:["5em"],children:[{type:"text",id:"txtWidth",requiredContent:"table{width}",controlStyle:"width:5em",label:i.lang.common.width,title:i.lang.common.cssLengthTooltip,"default":i.filter.check("table{width}")?d.getSize("width")<500?"100%":500:0,getValue:o,validate:CKEDITOR.dialog.validate.cssLength(i.lang.common.invalidCssLength.replace("%1",i.lang.common.width)),onChange:function(){var t=this.getDialog().getContentElement("advanced","advStyles");t&&t.updateStyle("width",this.getValue())},setup:function(t){var e=t.getStyle("width");this.setValue(e)},commit:s}]},{type:"hbox",widths:["5em"],children:[{type:"text",id:"txtHeight",requiredContent:"table{height}",controlStyle:"width:5em",label:i.lang.common.height,title:i.lang.common.cssLengthTooltip,"default":"",getValue:o,validate:CKEDITOR.dialog.validate.cssLength(i.lang.common.invalidCssLength.replace("%1",i.lang.common.height)),onChange:function(){var t=this.getDialog().getContentElement("advanced","advStyles");t&&t.updateStyle("height",this.getValue())},setup:function(t){var e=t.getStyle("height");e&&this.setValue(e)},commit:s}]},{type:"html",html:"&nbsp;"},{type:"text",id:"txtCellSpace",requiredContent:"table[cellspacing]",controlStyle:"width:3em",label:i.lang.jisxtable.cellSpace,"default":i.filter.check("table[cellspacing]")?1:0,validate:CKEDITOR.dialog.validate.number(i.lang.jisxtable.invalidCellSpacing),setup:function(t){this.setValue(t.getAttribute("cellSpacing")||"")},commit:function(t,e){this.getValue()?e.setAttribute("cellSpacing",this.getValue()):e.removeAttribute("cellSpacing")}},{type:"text",id:"txtCellPad",requiredContent:"table[cellpadding]",controlStyle:"width:3em",label:i.lang.jisxtable.cellPad,"default":i.filter.check("table[cellpadding]")?1:0,validate:CKEDITOR.dialog.validate.number(i.lang.jisxtable.invalidCellPadding),setup:function(t){this.setValue(t.getAttribute("cellPadding")||"")},commit:function(t,e){this.getValue()?e.setAttribute("cellPadding",this.getValue()):e.removeAttribute("cellPadding")}}]}]},{type:"html",align:"right",html:""},{type:"vbox",padding:0,children:[{type:"text",id:"txtCaption",requiredContent:"caption",required:!0,validate:CKEDITOR.dialog.validate.notEmpty(i.lang.jisxtable.invalidEmptyCaption),label:i.lang.jisxtable.caption,setup:function(t){this.enable();var e=t.getElementsByTag("caption");if(e.count()>0){var i=e.getItem(0),n=i.getFirst(CKEDITOR.dom.walker.nodeType(CKEDITOR.NODE_ELEMENT));if(n&&!n.equals(i.getBogus()))return this.disable(),void this.setValue(i.getText());i=CKEDITOR.tools.trim(i.getText()),this.setValue(i)}},commit:function(t,e){if(this.isEnabled()){var n=this.getValue(),l=e.getElementsByTag("caption");if(n)l.count()>0?(l=l.getItem(0),l.setHtml("")):(l=new CKEDITOR.dom.element("caption",i.document),e.getChildCount()?l.insertBefore(e.getFirst()):l.appendTo(e)),l.append(new CKEDITOR.dom.text(n,i.document));else if(l.count()>0)for(var a=l.count()-1;a>=0;a--)l.getItem(a).remove()}}},{type:"text",id:"txtSummary",requiredContent:"table[summary]",label:i.lang.jisxtable.summary,required:!0,validate:CKEDITOR.dialog.validate.notEmpty(i.lang.jisxtable.invalidEmptySummary),setup:function(t){this.setValue(t.getAttribute("summary")||"")},commit:function(t,e){this.getValue()?e.setAttribute("summary",this.getValue()):e.removeAttribute("summary")}}]}]},l(i,null,"table")]}}var o=CKEDITOR.tools.cssLength,s=function(t){var e=this.id;t.info||(t.info={}),t.info[e]=this.getValue()},d={id:1,dir:1,classes:1,styles:1};CKEDITOR.dialog.add("jisxtable",function(t){return a(t,"jisxtable")}),CKEDITOR.dialog.add("jisxtableProperties",function(t){return a(t,"jisxtableProperties")}),CKEDITOR.dialog.add("jisxtableHeaderId",function(t){return{title:"\u898b\u51fa\u3057\u8a2d\u5b9a",minWidth:300,minHeight:80,contents:[{id:"tab1",elements:[{type:"text",id:"table_header_id",label:"\u898b\u51fa\u3057\u306e\u30bb\u30eb\u306eID\u3092\u6307\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044.",validate:CKEDITOR.dialog.validate.notEmpty("\u898b\u51fa\u3057ID\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044"),setup:function(t){this.setValue(t.getAttribute("id"))},commit:function(t){var e=this.id;t.info||(t.info={}),t.info[e]=this.getValue()}}]}],onShow:function(){var e,i=t.getSelection(),n=i.getRanges(),l=i.getSelectedElement();l&&l.is("th")?e=l:n.length>0&&(CKEDITOR.env.webkit&&n[0].shrink(CKEDITOR.NODE_ELEMENT),e=t.elementPath(n[0].getCommonAncestor(!0)).contains("th",1)),this._.selectedElement=e,e&&this.setupContent(e)},onOk:function(){var e=t.getSelection(),i=(this._.selectedElement&&e.createBookmarks(),this._.selectedElement);me=this,data={},this.commitContent(data,i),data.info&&i.setAttribute("id",data.info.table_header_id)}}}),CKEDITOR.dialog.add("jisxtableDataHeaders",function(t){return{title:"\u898b\u51fa\u3057\u6307\u5b9a",minWidth:300,minHeight:80,contents:[{id:"tab1",elements:[{type:"text",id:"table_headers",label:"\u898b\u51fa\u3057\u3092\u6307\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044.<br/>\u534a\u89d2\u30b9\u30da\u30fc\u30b9\u533a\u5207\u308a\u3067\u8907\u6570\u306e\u898b\u51fa\u3057\u3092\u6307\u5b9a\u3067\u304d\u307e\u3059",validate:CKEDITOR.dialog.validate.notEmpty("\u898b\u51fa\u3057\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044"),setup:function(t){this.setValue(t.getAttribute("headers"))},commit:function(t){var e=this.id;t.info||(t.info={}),t.info[e]=this.getValue()}}]}],onShow:function(){var e,i=t.getSelection(),n=i.getRanges(),l=i.getSelectedElement();l&&l.is("td")?e=l:n.length>0&&(CKEDITOR.env.webkit&&n[0].shrink(CKEDITOR.NODE_ELEMENT),e=t.elementPath(n[0].getCommonAncestor(!0)).contains("td",1)),this._.selectedElement=e,e&&this.setupContent(e)},onOk:function(){var e=t.getSelection(),i=(this._.selectedElement&&e.createBookmarks(),this._.selectedElement);me=this,data={},this.commitContent(data,i),data.info&&i.setAttribute("headers",data.info.table_headers)}}})}();