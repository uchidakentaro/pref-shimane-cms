!function(){function e(e){function t(e){l.length>0||e.type==CKEDITOR.NODE_ELEMENT&&I.test(e.getName())&&!e.getCustomData("selected_cell")&&(CKEDITOR.dom.element.setMarker(r,e,"selected_cell",!0),l.push(e))}for(var n=e.getRanges(),l=[],r={},o=0;o<n.length;o++){var a=n[o];if(a.collapsed){var c=a.getCommonAncestor(),i=c.getAscendant("td",!0)||c.getAscendant("th",!0);i&&l.push(i)}else{var s,d=new CKEDITOR.dom.walker(a);for(d.guard=t;s=d.next();)if(s.type!=CKEDITOR.NODE_ELEMENT||!s.is(CKEDITOR.dtd.table)){var u=s.getAscendant("td",!0)||s.getAscendant("th",!0);u&&!u.getCustomData("selected_cell")&&(CKEDITOR.dom.element.setMarker(r,u,"selected_cell",!0),l.push(u))}}}return CKEDITOR.dom.element.clearAllMarkers(r),l}function t(e){for(var t,n,l,r=0,o=e.length-1,a={};t=e[r++];)CKEDITOR.dom.element.setMarker(a,t,"delete_cell",!0);for(r=0;t=e[r++];)if((n=t.getPrevious())&&!n.getCustomData("delete_cell")||(n=t.getNext())&&!n.getCustomData("delete_cell"))return CKEDITOR.dom.element.clearAllMarkers(a),n;return CKEDITOR.dom.element.clearAllMarkers(a),l=e[0].getParent(),(l=l.getPrevious())?l.getLast():(l=e[o].getParent(),(l=l.getNext())?l.getChild(0):null)}function n(t,n){for(var l=e(t),r=l[0],o=r.getAscendant("table"),a=r.getDocument(),c=l[0].getParent(),i=c.$.rowIndex,s=l[l.length-1],d=s.getParent().$.rowIndex+s.$.rowSpan-1,u=new CKEDITOR.dom.element(o.$.rows[d]),m=n?i:d,T=n?c:u,g=CKEDITOR.tools.buildTableMap(o),p=g[m],f=n?g[m-1]:g[m+1],I=g[0].length,E=a.createElement("tr"),b=0;p[b]&&b<I;b++){var C;p[b].rowSpan>1&&f&&p[b]==f[b]?(C=p[b],C.rowSpan+=1):(C=new CKEDITOR.dom.element(p[b]).clone(),C.removeAttribute("rowSpan"),!CKEDITOR.env.ie&&C.appendBogus(),E.append(C),C=C.$),b+=C.colSpan-1}n?E.insertBefore(T):E.insertAfter(T)}function l(t){if(t instanceof CKEDITOR.dom.selection){for(var n=e(t),r=n[0],o=r.getAscendant("table"),a=CKEDITOR.tools.buildTableMap(o),c=n[0].getParent(),i=c.$.rowIndex,s=n[n.length-1],d=s.getParent().$.rowIndex+s.$.rowSpan-1,u=[],m=i;m<=d;m++){for(var T=a[m],g=new CKEDITOR.dom.element(o.$.rows[m]),p=0;p<T.length;p++){var f=new CKEDITOR.dom.element(T[p]),I=f.getParent().$.rowIndex;if(1==f.$.rowSpan)f.remove();else if(f.$.rowSpan-=1,I==m){var E=a[m+1];E[p-1]?f.insertAfter(new CKEDITOR.dom.element(E[p-1])):new CKEDITOR.dom.element(o.$.rows[m+1]).append(f,1)}p+=f.$.colSpan-1}u.push(g)}var b=o.$.rows,C=new CKEDITOR.dom.element(b[d+1]||(i>0?b[i-1]:null)||o.$.parentNode);for(m=u.length;m>=0;m--)l(u[m]);return C}return t instanceof CKEDITOR.dom.element&&(o=t.getAscendant("table"),1==o.$.rows.length?o.remove():t.remove()),null}function r(e,t){for(var n=e.getParent(),l=n.$.cells,r=0,o=0;o<l.length;o++){var a=l[o];if(r+=t?1:a.colSpan,a==e.$)break}return r-1}function o(e,t){for(var n=t?Infinity:0,l=0;l<e.length;l++){var o=r(e[l],t);(t?o<n:o>n)&&(n=o)}return n}function a(t,n){for(var l=e(t),r=l[0],a=r.getAscendant("table"),c=o(l,1),i=o(l),s=n?c:i,d=CKEDITOR.tools.buildTableMap(a),u=[],m=[],T=d.length,g=0;g<T;g++){u.push(d[g][s]);var p=n?d[g][s-1]:d[g][s+1];m.push(p)}for(g=0;g<T;g++){var f;u[g]&&(u[g].colSpan>1&&m[g]==u[g]?(f=u[g],f.colSpan+=1):(f=new CKEDITOR.dom.element(u[g]).clone(),f.removeAttribute("colSpan"),!CKEDITOR.env.ie&&f.appendBogus(),f[n?"insertBefore":"insertAfter"].call(f,new CKEDITOR.dom.element(u[g])),f=f.$),g+=f.rowSpan-1)}}function c(t){for(var n,l,r=e(t),o=r[0],a=r[r.length-1],c=o.getAscendant("table"),i=CKEDITOR.tools.buildTableMap(c),s=[],d=0,u=i.length;d<u;d++)for(var m=0,T=i[d].length;m<T;m++)i[d][m]==o.$&&(n=m),i[d][m]==a.$&&(l=m);for(d=n;d<=l;d++)for(m=0;m<i.length;m++){var g=i[m],p=new CKEDITOR.dom.element(c.$.rows[m]),f=new CKEDITOR.dom.element(g[d]);f.$&&(1==f.$.colSpan?f.remove():f.$.colSpan-=1,m+=f.$.rowSpan-1,p.$.cells.length||s.push(p))}var I=c.$.rows[0]&&c.$.rows[0].cells,E=new CKEDITOR.dom.element(I[n]||(n?I[n-1]:c.$.parentNode));return s.length==u&&c.remove(),E}function i(e,t){var n=e.getStartElement(),l=n.getAscendant("td",1)||n.getAscendant("th",1);if(l){var r=l.clone();CKEDITOR.env.ie||r.appendBogus(),t?r.insertBefore(l):r.insertAfter(l)}}function s(n){if(n instanceof CKEDITOR.dom.selection){for(var l=e(n),r=l[0]&&l[0].getAscendant("table"),o=t(l),a=l.length-1;a>=0;a--)s(l[a]);o?u(o,!0):r&&r.remove()}else if(n instanceof CKEDITOR.dom.element){var c=n.getParent();1==c.getChildCount()?c.remove():n.remove()}}function d(e){var t=e.getBogus();t&&t.remove(),e.trim()}function u(e,t){var n=e.getDocument(),l=CKEDITOR.document;CKEDITOR.env.ie&&10==CKEDITOR.env.version&&(l.focus(),n.focus());var r=new CKEDITOR.dom.range(n);r["moveToElementEdit"+(t?"End":"Start")](e)||(r.selectNodeContents(e),r.collapse(!t)),r.select(!0)}function m(e,t,n){var l=e[t];if(void 0===n)return l;for(var r=0;l&&r<l.length;r++){if(n.is&&l[r]==n.$)return r;if(r==n)return new CKEDITOR.dom.element(l[r])}return n.is?-1:null}function T(e,t){for(var n=[],l=0;l<e.length;l++){var r=e[l];n.push(r[t]),r[t].rowSpan>1&&(l+=r[t].rowSpan-1)}return n}function g(t,n,l){var r,o=e(t);if((n?1!=o.length:o.length<2)||(r=t.getCommonAncestor())&&r.type==CKEDITOR.NODE_ELEMENT&&r.is("table"))return!1;var a,c=o[0],i=c.getAscendant("table"),s=CKEDITOR.tools.buildTableMap(i),u=s.length,T=s[0].length,g=c.getParent().$.rowIndex,p=m(s,g,c);if(n){var f;try{var I=parseInt(c.getAttribute("rowspan"),10)||1,E=parseInt(c.getAttribute("colspan"),10)||1;f=s["up"==n?g-I:"down"==n?g+I:g]["left"==n?p-E:"right"==n?p+E:p]}catch(e){return!1}if(!f||c.$==f)return!1;o["up"==n||"left"==n?"unshift":"push"](new CKEDITOR.dom.element(f))}for(var b=c.getDocument(),C=g,D=0,R=0,w=!l&&new CKEDITOR.dom.documentFragment(b),O=0,v=0;v<o.length;v++){a=o[v];var S=a.getParent(),A=a.getFirst(),K=a.$.colSpan,h=a.$.rowSpan,_=S.$.rowIndex,$=m(s,_,a);if(O+=K*h,R=Math.max(R,$-p+K),D=Math.max(D,_-g+h),!l){if(d(a),a.getChildren().count()){if(_!=C&&A&&(!A.isBlockBoundary||!A.isBlockBoundary({br:1}))){var F=w.getLast(CKEDITOR.dom.walker.whitespaces(!0));!F||F.is&&F.is("br")||w.append("br")}a.moveChildren(w)}v?a.remove():a.setHtml("")}C=_}if(l)return D*R==O;w.moveChildren(c),CKEDITOR.env.ie||c.appendBogus(),R>=T?c.removeAttribute("rowSpan"):c.$.rowSpan=D,D>=u?c.removeAttribute("colSpan"):c.$.colSpan=R;var x=new CKEDITOR.dom.nodeList(i.$.rows),B=x.count();for(v=B-1;v>=0;v--){var M=x.getItem(v);M.$.cells.length||(M.remove(),B++)}return c}function p(t,n){var l=e(t);if(l.length>1)return!1;if(n)return!0;var r,o,a,c,i=l[0],s=i.getParent(),d=s.getAscendant("table"),u=CKEDITOR.tools.buildTableMap(d),T=s.$.rowIndex,g=m(u,T,i),p=i.$.rowSpan;if(p>1){o=Math.ceil(p/2),a=Math.floor(p/2),c=T+o;var f,I=new CKEDITOR.dom.element(d.$.rows[c]),E=m(u,c);r=i.clone();for(var b=0;b<E.length;b++){if(f=E[b],f.parentNode==I.$&&b>g){r.insertBefore(new CKEDITOR.dom.element(f));break}f=null}f||I.append(r,!0)}else{a=o=1,I=s.clone(),I.insertAfter(s),I.append(r=i.clone());for(var C=m(u,T),D=0;D<C.length;D++)C[D].rowSpan++}return CKEDITOR.env.ie||r.appendBogus(),i.$.rowSpan=o,r.$.rowSpan=a,1==o&&i.removeAttribute("rowSpan"),1==a&&r.removeAttribute("rowSpan"),r}function f(t,n){var l=e(t);if(l.length>1)return!1;if(n)return!0;var r,o,a,c=l[0],i=c.getParent(),s=i.getAscendant("table"),d=CKEDITOR.tools.buildTableMap(s),u=i.$.rowIndex,g=m(d,u,c),p=c.$.colSpan;if(p>1)o=Math.ceil(p/2),a=Math.floor(p/2);else{a=o=1;for(var f=T(d,g),I=0;I<f.length;I++)f[I].colSpan++}return r=c.clone(),r.insertAfter(c),CKEDITOR.env.ie||r.appendBogus(),c.$.colSpan=o,r.$.colSpan=a,1==o&&c.removeAttribute("colSpan"),1==a&&r.removeAttribute("colSpan"),r}var I=/^(?:td|th)$/;CKEDITOR.plugins.jisxtabletools={requires:"jisxtable,dialog,contextmenu",init:function(t){function r(e){return CKEDITOR.tools.extend(e||{},{contextSensitive:1,refresh:function(e,t){this.setState(t.contains({td:1,th:1},1)?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED)}})}function o(e,n){var l=t.addCommand(e,n);t.addFeature(l)}var d=t.lang.table;o("cellProperties",new CKEDITOR.dialogCommand("cellProperties",r({allowedContent:"td th{width,height,border-color,background-color,white-space,vertical-align,text-align}[colspan,rowspan]",requiredContent:"table"}))),CKEDITOR.dialog.add("cellProperties",this.path+"dialogs/tableCell.js"),o("rowDelete",r({requiredContent:"table",exec:function(e){u(l(e.getSelection()))}})),o("rowInsertBefore",r({requiredContent:"table",exec:function(e){n(e.getSelection(),!0)}})),o("rowInsertAfter",r({requiredContent:"table",exec:function(e){n(e.getSelection())}})),o("columnDelete",r({requiredContent:"table",exec:function(e){var t=e.getSelection(),n=c(t);n&&u(n,!0)}})),o("columnInsertBefore",r({requiredContent:"table",exec:function(e){a(e.getSelection(),!0)}})),o("columnInsertAfter",r({requiredContent:"table",exec:function(e){a(e.getSelection())}})),o("cellDelete",r({requiredContent:"table",exec:function(e){s(e.getSelection())}})),o("cellMerge",r({allowedContent:"td[colspan,rowspan]",requiredContent:"td[colspan,rowspan]",exec:function(e){u(g(e.getSelection()),!0)}})),o("cellMergeRight",r({allowedContent:"td[colspan]",requiredContent:"td[colspan]",exec:function(e){u(g(e.getSelection(),"right"),!0)}})),o("cellMergeDown",r({allowedContent:"td[rowspan]",requiredContent:"td[rowspan]",exec:function(e){u(g(e.getSelection(),"down"),!0)}})),o("cellVerticalSplit",r({allowedContent:"td[rowspan]",requiredContent:"td[rowspan]",exec:function(e){u(p(e.getSelection()))}})),o("cellHorizontalSplit",r({allowedContent:"td[colspan]",requiredContent:"td[colspan]",exec:function(e){u(f(e.getSelection()))}})),o("cellInsertBefore",r({requiredContent:"table",exec:function(e){i(e.getSelection(),!0)}})),o("cellInsertAfter",r({requiredContent:"table",exec:function(e){i(e.getSelection())}})),t.addMenuItems&&t.addMenuItems({tablecell:{label:d.cell.menu,group:"tablecell",order:1,getItems:function(){var n=t.getSelection(),l=e(n);return{tablecell_insertBefore:CKEDITOR.TRISTATE_OFF,tablecell_insertAfter:CKEDITOR.TRISTATE_OFF,tablecell_delete:CKEDITOR.TRISTATE_OFF,tablecell_merge:g(n,null,!0)?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED,tablecell_merge_right:g(n,"right",!0)?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED,tablecell_merge_down:g(n,"down",!0)?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED,tablecell_split_vertical:p(n,!0)?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED,tablecell_split_horizontal:f(n,!0)?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED,tablecell_properties:l.length>0?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED}}},tablecell_insertBefore:{label:d.cell.insertBefore,group:"tablecell",command:"cellInsertBefore",order:5},tablecell_insertAfter:{label:d.cell.insertAfter,group:"tablecell",command:"cellInsertAfter",order:10},tablecell_delete:{label:d.cell.deleteCell,group:"tablecell",command:"cellDelete",order:15},tablecell_merge:{label:d.cell.merge,group:"tablecell",command:"cellMerge",order:16},tablecell_merge_right:{label:d.cell.mergeRight,group:"tablecell",command:"cellMergeRight",order:17},tablecell_merge_down:{label:d.cell.mergeDown,group:"tablecell",command:"cellMergeDown",order:18},tablecell_split_horizontal:{label:d.cell.splitHorizontal,group:"tablecell",command:"cellHorizontalSplit",order:19},tablecell_split_vertical:{label:d.cell.splitVertical,group:"tablecell",command:"cellVerticalSplit",order:20},tablecell_properties:{label:d.cell.title,group:"tablecellproperties",command:"cellProperties",order:21},tablerow:{label:d.row.menu,group:"tablerow",order:1,getItems:function(){return{tablerow_insertBefore:CKEDITOR.TRISTATE_OFF,tablerow_insertAfter:CKEDITOR.TRISTATE_OFF,tablerow_delete:CKEDITOR.TRISTATE_OFF}}},tablerow_insertBefore:{label:d.row.insertBefore,group:"tablerow",command:"rowInsertBefore",order:5},tablerow_insertAfter:{label:d.row.insertAfter,group:"tablerow",command:"rowInsertAfter",order:10},tablerow_delete:{label:d.row.deleteRow,group:"tablerow",command:"rowDelete",order:15},tablecolumn:{label:d.column.menu,group:"tablecolumn",order:1,getItems:function(){return{tablecolumn_insertBefore:CKEDITOR.TRISTATE_OFF,tablecolumn_insertAfter:CKEDITOR.TRISTATE_OFF,tablecolumn_delete:CKEDITOR.TRISTATE_OFF}}},tablecolumn_insertBefore:{label:d.column.insertBefore,group:"tablecolumn",command:"columnInsertBefore",order:5},tablecolumn_insertAfter:{label:d.column.insertAfter,group:"tablecolumn",command:"columnInsertAfter",order:10},tablecolumn_delete:{label:d.column.deleteColumn,group:"tablecolumn",command:"columnDelete",order:15}}),t.contextMenu&&t.contextMenu.addListener(function(e,t,n){var l=n.contains({td:1,th:1},1);return l&&!l.isReadOnly()?{tablecell:CKEDITOR.TRISTATE_OFF,tablerow:CKEDITOR.TRISTATE_OFF,tablecolumn:CKEDITOR.TRISTATE_OFF}:null})},getSelectedCells:e},CKEDITOR.plugins.add("jisxtabletools",CKEDITOR.plugins.jisxtabletools)}(),CKEDITOR.tools.buildTableMap=function(e){for(var t=e.$.rows,n=-1,l=[],r=0;r<t.length;r++){n++,!l[n]&&(l[n]=[]);for(var o=-1,a=0;a<t[r].cells.length;a++){var c=t[r].cells[a];for(o++;l[n][o];)o++;for(var i=isNaN(c.colSpan)?1:c.colSpan,s=isNaN(c.rowSpan)?1:c.rowSpan,d=0;d<s;d++){l[n+d]||(l[n+d]=[]);for(var u=0;u<i;u++)l[n+d][o+u]=t[r].cells[a]}o+=i-1}}return l};