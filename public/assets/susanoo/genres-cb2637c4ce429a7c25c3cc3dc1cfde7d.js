(function(){var e,t,n,r=function(e,t){return function(){return e.apply(t,arguments)}};t=function(){function e(){this.init=r(this.init,this)}return e.prototype.link_to=null,e.prototype.message=null,e.prototype.selected_genre=null,e.prototype.button_folder_select=$("#button-folder-select"),e.prototype.init=function(e){var t,n;n="/susanoo/genres/treeview",t="/susanoo/genres/select_genre",$("#treeview").fancytree({autoActivate:!1,source:e,activate:function(e,n){var r;if(r=n.node,!r.data.no_permission)return $.get(t,{genre_id:r.data.id})},lazyload:function(e,t){var r;return r=t.node,t.result={url:n,data:{id:r.data.id}}}}),$("#treeview-modal").fancytree({source:$.ajax({url:n}),activate:function(e){return function(t,n){var r;return r=n.node,r.data.no_permission?(e.selected_genre=null,$(e.button_folder_select).attr("disabled",!0)):(e.selected_genre={id:r.data.id,title:r.title},$(e.button_folder_select).attr("disabled",!1)),e.selected_genre}}(this),lazyload:function(e,t){var r;return r=t.node,t.result={url:n,data:{id:r.data.id}}}}),$(document).on("click","#file-index > tbody > tr",function(e){var t,n,r;return r=e.target,"TD"===r.tagName&&(n=$(".resource-selected"),n.removeClass("info"),n.removeClass("resource-selected"),t=$(this),t.addClass("info"),t.addClass("resource-selected"),$.ajax({url:"/susanoo/genres/select_resource",data:{type:t.attr("data-type"),id:t.attr("data-id")},dataType:"script"}))}),$(document).on("click","#button-move-genre",function(e){return function(t){e.link_to=$(t.currentTarget).attr("data-url"),e.message=$(t.currentTarget).attr("data-message"),e.selected_genre=null}}(this)),$(document).on("click","#button-copy-genre",function(e){return function(t){e.link_to=$(t.currentTarget).attr("data-url"),e.message=$(t.currentTarget).attr("data-message"),e.selected_genre=null}}(this)),$(document).on("click","#button-move-page",function(e){return function(t){e.link_to=$(t.currentTarget).attr("data-url"),e.message=$(t.currentTarget).attr("data-message"),e.selected_genre=null}}(this)),$(this.button_folder_select).click(function(e){return function(){$("#modal-folder-select").modal("hide"),e.selected_genre&&(e.message&&!confirm(e.message)||e.selected_genre&&e.link_to&&($.isLoading({text:"\u51e6\u7406\u4e2d"}),window.location=e.link_to+"?genre_id="+e.selected_genre.id))}}(this)).attr("disabled",!0),$(document).on("submit",".form-search",function(){return function(){return $.isLoading({text:"\u691c\u7d22\u4e2d"})}}()),$(document).on("click","div.move-link > a",function(){return function(){return $.isLoading({text:"\u51e6\u7406\u4e2d"})}}())},e}(),e=function(){function e(){}return e.prototype.init=function(){return $("#division_id").change(function(){var e;if(e=$("#division_id").val())return $.ajax({url:"/susanoo/genres/select_division",data:{division_id:e},dataType:"script"})})},e}(),this.Susanoo||(this.Susanoo={}),(n=this.Susanoo).Genre||(n.Genre={}),Susanoo.Genre.Index=new t,Susanoo.Genre.Form=new e}).call(this);